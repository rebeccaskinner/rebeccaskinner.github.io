<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Rebecca Skinner - Building A Todo List with Python and Flask</title>
        <link rel="stylesheet" href="../css/default.css" />
        <link rel="stylesheet" href="../css/syntax.css" />
        <link rel="icon" type="impage/png" href="../favicon.png">
    </head>
    <body>
        <header>
          <div class="logo">
            <a href="../">Rebecca Skinner</a>
          </div>
            <nav>
              <a href="../resume.html">Resume</a>
              <a href="https://github.com/rebeccaskinner/">Github</a>
              <a href="https://twitter.com/cercerilla">Twitter</a>
              <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>Building A Todo List with Python and Flask</h1>
            <article>
    <section class="header">
        Posted on May 11, 2018
        
            by Rebecca Skinner
        
    </section>
    <section>
        <h1 id="introduction">Introduction</h1>
<p>NB: The full source code to this application is available <a href="https://github.com/rebeccaskinner/py-todo">on github</a>.</p>
<p>The TODO List is a perrenial favorite of developers looking to learn a new language, framework, or technique. I recently joined a team that uses Python as one of their languages, and decided to create my own implementation of a basic todo list using python3 and Flask in order to hone my very rusty skills with dynamically typed OO languages. I decided to write up my thoughts here both to help other developers who are interested in understanding how to get a start with python, as well as offering a perspective to experienced python developers on how those of us coming from outside the python ecosystem may approach solving problems, and what hiccups we can encounter.</p>
<h1 id="defining-the-api">Defining the API</h1>
<p>The TODO list that we’re building is going to focus on acting as a backend service for some hypothetical rich frontend application. We aren’t concerned with serving up HTML, CSS, or JavaScript. Instead, we will concern ourselves with implementing a simple JSON API, outlined below.</p>
<h2 id="the-api-endpoint">The API Endpoint</h2>
<p>The first thing I wanted to do as I was working through this project was to ensure that my application’s interfaces were well specified. I wanted to limit the scope of the project to something that could be accomplished in a few hours, so rather than dive into understanding the python libraries for data interchange formats like protobufs, and tools like swagger, I decided to create an ad-hoc schema format for my API specification. The schema describes both the routes supported by the application, along with their HTTP methods and expected input and output types, as well as describing the types themselves. All data is exchanged using JSON.</p>
<p>The schema that I’m using is:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;human readable documentation string&quot;</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;endpoints&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;routename&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;http-method&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;accepts&quot;</span><span class="fu">:</span> <span class="st">&quot;expected json type&quot;</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;returns&quot;</span><span class="fu">:</span> <span class="st">&quot;json schema of the returned payload&quot;</span><span class="fu">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;human readable documentation string&quot;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;types&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;type-name&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;humand-readable documentation string&quot;</span><span class="fu">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;json type (object|array|number|string|bool) | typename&quot;</span><span class="fu">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;fields&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;object-key-name&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;object field description&quot;</span><span class="fu">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;json type (object|array|number|string|bool) | typename&quot;</span><span class="fu">,</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>          <span class="dt">&quot;required&quot;</span><span class="fu">:</span> <span class="st">&quot;bool&quot;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;values&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;allowed-values&quot;</span><span class="ot">]</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;key-type&quot;</span><span class="er">:</span> <span class="st">&quot;the type of keys in an object type&quot;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;value-type&quot;</span><span class="er">:</span> <span class="st">&quot;the type of the values in an object type&quot;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Throughout the post I’ll be incuding snippets of the JSON schema in the above format to disambiguate any discussion around the contract for the TODO list API.</p>
<p>The API description is exposed at the <code>/api</code> route:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;api&quot;:</span> <span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;get&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;returns&quot;</span><span class="fu">:</span> <span class="st">&quot;object&quot;</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;returns this json document&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span></code></pre></div>
<h2 id="tickets">Tickets</h2>
<p>A ticket in our TODO is a JSON object with two fields:</p>
<ul>
<li><code>status</code>: A textual description of the todo list item in human readable format</li>
<li><code>status</code>: A <code>status-string</code> type</li>
</ul>
<p>The status of a ticket describes it’s current status. The status type is a string enumeration consisting of the following values:</p>
<ul>
<li><code>todo</code>: Indicates an item that has not been started</li>
<li><code>in-progress</code>: Indicates an item that has been started but not completed</li>
<li><code>abandon</code>: Indicates an item that was canceled before completing</li>
<li><code>done</code>: Indicates an item that has been completed</li>
</ul>
<p>The full description of the <code>ticket-json</code> and <code>status-string</code> types are shown below:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ticket-json&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;json document describing a single ticket&quot;</span><span class="fu">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;object&quot;</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;fields&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;the status of a ticket&quot;</span><span class="fu">,</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;status-string&quot;</span><span class="fu">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;required&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;summary&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;human readable description of the ticket&quot;</span><span class="fu">,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;required&quot;</span><span class="fu">:</span> <span class="kw">false</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;status-string&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;string enumeration of ticket status&quot;</span><span class="fu">,</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;values&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;todo&quot;</span><span class="ot">,</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;in-progress&quot;</span><span class="ot">,</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;abandoned&quot;</span><span class="ot">,</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;done&quot;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="the-ticket-map">The Ticket Map</h3>
<p>Tickets in our application are referenced by ID numbers. These ticket ID numbers are simple JSON numbers, and we have created a type alias in our schema for them to provide documentation:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;ticket-id&quot;:</span> <span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;numeric id representing a ticket&quot;</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;number&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>The <code>ticket-map</code> type represents our association between ticket IDs and the actual ticket values. It’s a javascript object keyed on string representations of the <code>ticket-id</code> type and containing <code>ticket-json</code> values:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;ticket-map&quot;:</span> <span class="fu">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;map of ticket IDs to values&quot;</span><span class="fu">,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;object&quot;</span><span class="fu">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;key-type&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-id&quot;</span><span class="fu">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;value-type&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-json&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="todo-crud-operations">TODO CRUD Operations</h2>
<p>The TODO list supports basic CRUD operations. We can view the todo list, either in it’s entirety or based on the state of the items. Individual items in the list can have their text updated, or can be moved from one state to another. There is no limit on state transitions.</p>
<h3 id="global-operations">Global Operations</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;items&quot;:</span> <span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;get&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;returns&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-map&quot;</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;returns a list of all todo list items&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span><span class="er">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;pending&quot;:</span> <span class="fu">{</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;get&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;returns&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-map&quot;</span><span class="fu">,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;returns a list of all pending todo list items&quot;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span><span class="er">,</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;open&quot;:</span> <span class="fu">{</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;get&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;returns&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-map&quot;</span><span class="fu">,</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;returns a list of all open todo list items&quot;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span><span class="er">,</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;complete&quot;:</span> <span class="fu">{</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;get&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;returns&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-map&quot;</span><span class="fu">,</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;returns a list of all complete todo list items&quot;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span><span class="er">,</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;abandoned&quot;:</span> <span class="fu">{</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;get&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;returns&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-map&quot;</span><span class="fu">,</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;returns a list of all abandoned todo list items&quot;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span><span class="er">,</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="er">&quot;add&quot;:</span> <span class="fu">{</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;post&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;accepts&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-json&quot;</span><span class="fu">,</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;returns&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-id&quot;</span><span class="fu">,</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;adds a new todo list item&quot;</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="ticket-operations">Ticket Operations</h3>
<p>Individual tickets can be accessed by a route equal to the ticket’s <code>ticket-id</code>. Tickets support <code>GET</code>, <code>DELETE</code>, and <code>PUT</code> methods to fetch, remove, and update them respectively.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>  <span class="er">&quot;&lt;ticket-id&gt;&quot;:</span> <span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;get&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;returns&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-json&quot;</span><span class="fu">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;returns information about the given ticket&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;delete&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;deletes a given ticket&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;put&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;accepts&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-json&quot;</span><span class="fu">,</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;returns&quot;</span><span class="fu">:</span> <span class="st">&quot;ticket-json&quot;</span><span class="fu">,</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;updates ticket information&quot;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span></code></pre></div>
<h1 id="defining-the-data-model">Defining the Data Model</h1>
<p>We define three object types that will represent the data we need in our application. The <code>TodoStatus</code> type is a specialization of the <code>Enum</code> class that provides a mechanism to parse and display specific string representations of our enum values. The <code>TodoItem</code> type is a simple mutable object that tracks a given item’s description and completion state. The <code>List</code> type is a mutable collection of associations between todo item indexes and the items themselves. Each of these types are described in more detail below.</p>
<h2 id="the-status-type">The Status Type</h2>
<p>Although python does not allow us to leverage a type system to detect errors at compile time, we can still leverage the concept of sum types to allow us to effective express the expected states of a todo item. We accomplish this by creating a subclass of the builtin enumeration type, <code>Enum</code>, and defining numeric value mappings for each intended state.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TodoStatus(Enum):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    TODO <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    INPROGRESS <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    ABANDON <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    DONE <span class="op">=</span> <span class="dv">3</span></span></code></pre></div>
<p>For convenience, we wish for our TodoStatus to provide an instance of the stringification method <code>__str__</code>, allowing us to use basic print formatting strings to generate appropriate human-readable names. In this case, we will explicitly exist the application if we find ourselves in an unexpected state in order to avoid hiding any bugs caused by the unsoundness of our type system:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="va">self</span> <span class="op">==</span> TodoStatus.TODO:</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;todo&quot;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="va">self</span> <span class="op">==</span> TodoStatus.INPROGRESS:</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;in-progress&quot;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="va">self</span> <span class="op">==</span> TodoStatus.ABANDON:</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;abandoned&quot;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="va">self</span> <span class="op">==</span> TodoStatus.DONE:</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;done&quot;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;enumeration invariant failed: value out of range&quot;</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        sys.exit()</span></code></pre></div>
<p>Finally, as we will be wanting to parse user input in order to set the state of a todo list item, we need to create a mapping from strings to our todo status. We consider an invalid string to be part of the domain of our inputs, and return <code>None</code> if we receive an invalid string.</p>
<p>Of particular note here is that we do not leverage a nullable container, as the lack of compile-time enforcement of type constraints would render the benefits of a nullable type nearly moot and would come at the cost of rather more verbose interfaces.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse(<span class="bu">str</span>):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">str</span> <span class="op">==</span> <span class="st">&quot;todo&quot;</span>:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span>  TodoStatus.TODO</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">str</span> <span class="op">==</span> <span class="st">&quot;in-progress&quot;</span>:</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span>  TodoStatus.INPROGRESS</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">str</span> <span class="op">==</span> <span class="st">&quot;abandoned&quot;</span>:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span>  TodoStatus.ABANDON</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="bu">str</span> <span class="op">==</span> <span class="st">&quot;done&quot;</span>:</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span>  TodoStatus.DONE</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code></pre></div>
<h3 id="testing-the-ticket-status">Testing The Ticket Status</h3>
<p>We will create unit tests for stringification and parsing of our status types. Due to the very limited nature these are simple tests with full coverage.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestTodoStatus(unittest.TestCase):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_to_string(<span class="va">self</span>):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(<span class="st">&quot;todo&quot;</span>, todo.TodoStatus.TODO.<span class="fu">__str__</span>())</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(<span class="st">&quot;in-progress&quot;</span>, todo.TodoStatus.INPROGRESS.<span class="fu">__str__</span>())</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(<span class="st">&quot;abandoned&quot;</span>, todo.TodoStatus.ABANDON.<span class="fu">__str__</span>())</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(<span class="st">&quot;done&quot;</span>, todo.TodoStatus.DONE.<span class="fu">__str__</span>())</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_parse_string(<span class="va">self</span>):</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(todo.TodoStatus.parse(<span class="st">&quot;todo&quot;</span>), todo.TodoStatus.TODO)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(todo.TodoStatus.parse(<span class="st">&quot;in-progress&quot;</span>), todo.TodoStatus.INPROGRESS)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(todo.TodoStatus.parse(<span class="st">&quot;abandoned&quot;</span>), todo.TodoStatus.ABANDON)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(todo.TodoStatus.parse(<span class="st">&quot;done&quot;</span>), todo.TodoStatus.DONE)</span></code></pre></div>
<h2 id="the-todo-item-type">The Todo Item Type</h2>
<p>A todo list item is a mutable object that contains two fields: The <code>summary</code> is the textual description of the contents of the todo list item. The <code>status</code> is the <code>TodoStatus</code> that describes the state of the ticket.</p>
<p>Todo items only have four basic operations:</p>
<ul>
<li>Get the summary</li>
<li>Set the summary</li>
<li>Get the status</li>
<li>Set the status</li>
</ul>
<p>We have three unit tests that cover these primary use cases:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_new_item_sets_summary(<span class="va">self</span>):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    summary1 <span class="op">=</span> <span class="st">&quot;test summary&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    item <span class="op">=</span> todo.TodoItem(summary1)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual(summary1, item.description())</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_set_summary(<span class="va">self</span>):</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    summary1 <span class="op">=</span> <span class="st">&quot;test summary 1&quot;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    summary2 <span class="op">=</span> <span class="st">&quot;test summary 2&quot;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    item <span class="op">=</span> todo.TodoItem(summary1)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    item.set_summary(summary2)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual(summary2, item.description())</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_new_item_status_is_todo(<span class="va">self</span>):</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    item <span class="op">=</span> todo.TodoItem(<span class="st">&quot;summary1&quot;</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual(todo.TodoStatus.TODO, item.status())</span></code></pre></div>
<p>Our implementations are straightforward:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TodoItem:</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, summary):</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._summary <span class="op">=</span> summary</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._status <span class="op">=</span> TodoStatus.TODO</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> status(<span class="va">self</span>):</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._status</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> set_status(<span class="va">self</span>, status):</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._status <span class="op">=</span> status</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> description(<span class="va">self</span>):</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._summary</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> set_summary(<span class="va">self</span>, summary):</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._summary <span class="op">=</span> summary</span></code></pre></div>
<p>We also provide several convenience methods that allow us to quickly set the status to one of our pre-defined todo status types:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> todo(<span class="va">self</span>):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>._status <span class="op">=</span> TodoStatus.TODO</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inprogress(<span class="va">self</span>):</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>._status <span class="op">=</span> TodoStatus.INPROGRESS</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> abandon(<span class="va">self</span>):</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>._status <span class="op">=</span> TodoStatus.ABANDON</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> complete(<span class="va">self</span>):</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>._status <span class="op">=</span> TodoStatus.DONE</span></code></pre></div>
<p>One challenge that we’ll face when serving our API is the need to convert our todo items into the appropriate JSON representation as defined by our API. Python does not provide a reasoanble serialization combinator to allow us to easily encode our object directly into JSON, but we may abuse heterogenous dictionary types in order to generate an object whose natural serialization format is equivalent to our desired output format.</p>
<p>To accomplish this we define a <code>json_dict</code> function that will generate a dictionary whose keys are the desired key names of the generated JSON object, and whose values are likewise defined according to our specification:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> json_dict(<span class="va">self</span>):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {<span class="st">&quot;summary&quot;</span>: <span class="va">self</span>._summary, <span class="st">&quot;status&quot;</span>: <span class="va">self</span>._status.<span class="fu">__str__</span>()}</span></code></pre></div>
<h2 id="the-todo-list-type">The Todo List Type</h2>
<p>Our todo list is a simple container wrapping a dictionary keyed by ticket ID numbers with values of type <code>TodoItem</code>. Our list type will support basic CRUD operations as well as allowing us to filter and extract items based on their completion state.</p>
<p>We start by writing tests that allow us to create an empty list, insert items into it, and to verify that they exist:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_new_list(<span class="va">self</span>):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span> <span class="op">=</span> todo.List()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual(<span class="dv">0</span>, <span class="bu">list</span>.total_count())</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_add_item_returns_element_index(<span class="va">self</span>):</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span> <span class="op">=</span> todo.List()</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> <span class="st">&quot;summary1&quot;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span> <span class="op">=</span> <span class="bu">list</span>.add_item(summary)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual(summary, <span class="bu">list</span>.lookup(<span class="bu">id</span>).description())</span></code></pre></div>
<p>Creating our basic list is simple. We define two internal private variables, <code>_list</code>, which is initialized to an empty dictionary, and <code>_idx</code>, a stateful method of tracking the last inserted index.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> List:</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._list <span class="op">=</span> {}</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_item(<span class="va">self</span>, summary):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="va">self</span>._idx</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._list[idx] <span class="op">=</span> TodoItem(summary)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._idx <span class="op">=</span> <span class="va">self</span>._idx <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> idx</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> lookup(<span class="va">self</span>, idx):</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">not</span> <span class="kw">in</span> <span class="va">self</span>._list:</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._list[idx]</span></code></pre></div>
<p>Next we provide several capabilities around looking at the total volume if items, as well as removing items:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_remove_item_when_item_exists(<span class="va">self</span>):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span> <span class="op">=</span> todo.List()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> <span class="bu">list</span>.add_item(<span class="st">&quot;summary&quot;</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>.remove_item(idx)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual(<span class="va">None</span>, <span class="bu">list</span>.lookup(idx))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_remove_item_when_item_not_exists(<span class="va">self</span>):</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span> <span class="op">=</span> todo.List()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>.remove_item(<span class="dv">999</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_list_size_increases_when_new_item_added(<span class="va">self</span>):</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span> <span class="op">=</span> todo.List()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>.add_item(<span class="st">&quot;summary&quot;</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual(<span class="dv">1</span>, <span class="bu">list</span>.total_count())</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_list_todo_item_shows_number_of_todo_items(<span class="va">self</span>):</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span> <span class="op">=</span> todo.List()</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>.add_item(<span class="st">&quot;summary&quot;</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual(<span class="dv">1</span>, <span class="bu">list</span>.total_count())</span></code></pre></div>
<p>Implementing these functions requires little more than wrapping built-in functions for dictionaries:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> total_count(<span class="va">self</span>):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>._list)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_item(<span class="va">self</span>, idx):</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> idx <span class="kw">in</span> <span class="va">self</span>._list:</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> <span class="va">self</span>._list[idx]</span></code></pre></div>
<p>We provide tests that prove that we can access collections of tickets given a specific desired ticket state:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_list_open_items_returns_inprogress_items(<span class="va">self</span>):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span> <span class="op">=</span> todo.List()</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> <span class="bu">list</span>.add_item(<span class="st">&quot;summary&quot;</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>.lookup(idx).inprogress()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual({idx: <span class="bu">list</span>.lookup(idx)}, <span class="bu">list</span>.open_items())</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>.lookup(idx).complete()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual({}, <span class="bu">list</span>.open_items())</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_list_todo_items_returns_todo_items(<span class="va">self</span>):</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span> <span class="op">=</span> todo.List()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> <span class="bu">list</span>.add_item(<span class="st">&quot;summary&quot;</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual({idx: <span class="bu">list</span>.lookup(idx)}, <span class="bu">list</span>.todo_items())</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>.lookup(idx).inprogress()</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.assertEqual({}, <span class="bu">list</span>.todo_items())</span></code></pre></div>
<p>Although we provide convenience methods to access all tickets for each of our defined states, we abstract the actual lookup into a single method, <code>items_by_state</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> items_by_state(<span class="va">self</span>, state):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    found <span class="op">=</span> {}</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key, item <span class="kw">in</span> <span class="va">self</span>._list.items():</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> item.status() <span class="op">==</span> state:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>            found[key] <span class="op">=</span> item</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> found</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> open_items(<span class="va">self</span>):</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">self</span>.items_by_state(TodoStatus.INPROGRESS)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> todo_items(<span class="va">self</span>):</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">self</span>.items_by_state(TodoStatus.TODO)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> abandoned_items(<span class="va">self</span>):</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">self</span>.items_by_state(TodoStatus.ABANDON)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> complete_items(<span class="va">self</span>):</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">self</span>.items_by_state(TodoStatus.DONE)</span></code></pre></div>
<p>The final step to finishing up or List class is, as with <code>TodoItem</code>, providing a way to easily generate serialized json. We will define a <code>json_dict</code> for our <code>List</code> type as well, and simply call <code>json_dict</code> on each member of our dictionary to generate the values in our JSON object:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> json_dict(<span class="va">self</span>):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    items <span class="op">=</span> {}</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, v <span class="kw">in</span> <span class="va">self</span>._list.items():</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        items[k] <span class="op">=</span> v.json_dict()</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> items</span></code></pre></div>
<h1 id="implementing-the-web-service">Implementing the Web Service</h1>
<p>Having defined the core components of our web service, we need to expose it to users via HTTP. We’ll be using the <a href="http://flask.pocoo.org">Flask web framework</a> to impelement our HTTP service.</p>
<p>We’ll start by creating a flask application, this will be what handles our application routing and manages the HTTP connections themselves:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> Flask(<span class="va">__name__</span>)</span></code></pre></div>
<p>Next we need to create a <code>List</code> to use for user interactions:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span> <span class="op">=</span> List()</span></code></pre></div>
<p>Flask uses the <code>.route</code> decorator to attach python functions to routes with the framework. The example below provides a very based route for <code>/</code> that directs the user to review the documentation available at the <code>/api</code> route:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">'/'</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> home():</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;Not much to see here!  See '/api' for API documentation&quot;</span></span></code></pre></div>
<p>The return value of functions that are attached to routes are polymorphic over three value types:</p>
<ul>
<li>string: Where we return the HTTP response body as a simple string</li>
<li>(string, Dict string string): Returns a tuple with the http response body as a string and a dictionary whose keys are HTTP response header names, and whose values are the values for the associated header</li>
<li>(string, integer, Dict string string): Returns a thruple of the http response body as a string, the numeric HTTP status code, and a dictionary of header names to header values</li>
</ul>
<h2 id="adapting-ticket-sets">Adapting Ticket Sets</h2>
<p>Many of our list functions return a dict mapping integers to tickets. We need to convert these returned types into an appropriate JSON-serializable type. To accomplish this we implement a function <code>convertDict</code> that will perform the appropriate conversion:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convertDict(item_map):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    result_map <span class="op">=</span> {}</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k, v <span class="kw">in</span> item_map.items():</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        result_map[k] <span class="op">=</span> v.json_dict()</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result_map</span></code></pre></div>
<h2 id="basic-query-routes">Basic Query Routes</h2>
<p>The majority of our HTTP endpoints are simply allowing the user to list tickets with some basic filtration. These each follow a similar basic pattern and are shown collectively below:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">'/api'</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="bu">help</span>():</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;api.json&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        contents <span class="op">=</span> f.read()</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (contents, {<span class="st">&quot;Content-Type&quot;</span>: <span class="st">&quot;application/json&quot;</span>})</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&quot;/items&quot;</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> items():</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (json.dumps(<span class="bu">list</span>.json_dict()), {<span class="st">&quot;Content-Type&quot;</span>: <span class="st">&quot;application/json&quot;</span>})</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&quot;/open&quot;</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> open_items():</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (json.dumps(convertDict(<span class="bu">list</span>.open_items())), {<span class="st">&quot;Content-Type&quot;</span>: <span class="st">&quot;application/json&quot;</span>})</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&quot;/complete&quot;</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> complete_items():</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (json.dumps(convertDict(<span class="bu">list</span>.complete_items())), {<span class="st">&quot;Content-Type&quot;</span>: <span class="st">&quot;application/json&quot;</span>})</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&quot;/abandoned&quot;</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> abandoned_items():</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (json.dumps(convertDict(<span class="bu">list</span>.abandoned_items())), {<span class="st">&quot;Content-Type&quot;</span>: <span class="st">&quot;application/json&quot;</span>})</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&quot;/pending&quot;</span>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pending_items():</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (json.dumps(convertDict(<span class="bu">list</span>.todo_items())), {<span class="st">&quot;Content-Type&quot;</span>: <span class="st">&quot;application/json&quot;</span>})</span></code></pre></div>
<h2 id="creating-new-tickets">Creating New Tickets</h2>
<p>The <code>add</code> route is the first route we’ve encountered that use an HTTP method other than <code>GET</code>. In this case, we expect the user to <code>POST</code> data to our endpoint. The POST body should contain JSON data that deserializes into a dictionary containing a required summary and optional stating status.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&quot;/add&quot;</span>, methods<span class="op">=</span>[<span class="st">'POST'</span>])</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add():</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> request.get_json(force <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> <span class="kw">lambda</span> x: x</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;summary&quot;</span> <span class="kw">not</span> <span class="kw">in</span> data:</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="st">&quot;missing summary field&quot;</span>, <span class="dv">400</span>, {})</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;status&quot;</span> <span class="kw">in</span> data:</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        status <span class="op">=</span> TodoStatus.parse(data[<span class="st">&quot;status&quot;</span>])</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> status <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> (<span class="st">&quot;invalid status&quot;</span>, <span class="dv">400</span>, {})</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        f <span class="op">=</span> <span class="kw">lambda</span> x: x.set_status(status)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> <span class="bu">list</span>.add_item(data[<span class="st">&quot;summary&quot;</span>])</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    f(<span class="bu">list</span>.lookup(idx))</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="st">&quot;</span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(idx), {<span class="st">&quot;Content-Type&quot;</span>: <span class="st">&quot;application/plaintext&quot;</span>})</span></code></pre></div>
<p>To implement this route, we use <code>request.get_json</code> to fetch the body of the HTTP message as a dictionary generated by deserializing JSON (the <code>force = True</code> parameter tells Flask to not require the user set the <code>Content-Type: application/json</code> header- a conveninece for testing with curl.</p>
<p>After performing some basic validation to ensure the summary is set, and that if a status has been set that it is a valid status, we create and configure the todo list item, finally sending a plaintext response containing the stringified numeric index of the newly added item.</p>
<h2 id="item-rud-operations">Item RUD Operations</h2>
<p>The individual ticket endpoints are the msot complicated of our routes. We need to capture the route into a variable and then support three separate requests depending on the HTTP method used.</p>
<p>To implement this we start by creating a top level function for the route:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&quot;/&lt;int:item_id&gt;&quot;</span>, methods<span class="op">=</span>[<span class="st">'GET'</span>,<span class="st">'PUT'</span>,<span class="st">'DELETE'</span>])</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> item(item_id):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> request.method <span class="op">==</span> <span class="st">'GET'</span>:</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> get_item(item_id)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> request.method <span class="op">==</span> <span class="st">'PUT'</span>:</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> update_item(item_id,request.get_json(force <span class="op">=</span> <span class="va">True</span>))</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> request.method <span class="op">==</span> <span class="st">'DELETE'</span>:</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> remove_item(item_id)</span></code></pre></div>
<p>The <code>&lt;int:item_id&gt;</code> syntax allows us to capture a variable from our route, and provide Flask with a hint as to the type we expect to get. The <code>request.method</code> value allows us to look at the HTTP request type. We use this information to call out to one of three specialized functions that will handle the work for each of the actions dictated by the HTTP methods:</p>
<h3 id="getting-an-item">Getting an Item</h3>
<p>Getting an item is straighforward. We look in our list for the item ID. If it’s found we convert it to JSON and return the value, otherwise we return an HTTP status code 404.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_item(item_id):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    item <span class="op">=</span> <span class="bu">list</span>.lookup(item_id)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> item <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="st">&quot;no such item&quot;</span>, <span class="dv">404</span>, {})</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (json.dumps(item.json_dict()), {<span class="st">&quot;Content-Type&quot;</span>: <span class="st">&quot;application/json&quot;</span>})</span></code></pre></div>
<h3 id="removing-an-item">Removing an Item</h3>
<p>Removing an item will never fail, allowing the user to remove items without first querying to see if they have already been removed. Our remove function simply calls <code>list.remove_item</code> and then returns an HTTP status code 200.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_item(item_id):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>.remove_item(item_id)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="st">&quot;&quot;</span>,<span class="dv">200</span>,{})</span></code></pre></div>
<h3 id="updating-an-item">Updating an Item</h3>
<p>Our update process works very much like our <code>add</code> endpoint, with the addition of a verification step to ensure that the item already exists. We also treat the summary field as optional rather than required as it is when we are creating a new item.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_item(item_id, item_map):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    item <span class="op">=</span> <span class="bu">list</span>.lookup(item_id)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> item <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="st">&quot;no such item&quot;</span>, <span class="dv">404</span>, {})</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;status&quot;</span> <span class="kw">in</span> item_map:</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        parsed <span class="op">=</span> TodoStatus.parse(item_map[<span class="st">&quot;status&quot;</span>])</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> parsed <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> (<span class="st">&quot;invalid status&quot;</span>, <span class="dv">400</span>, {})</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        item.set_status(parsed)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;summary&quot;</span> <span class="kw">in</span> item_map:</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        item.set_summary(item_map[<span class="st">&quot;summary&quot;</span>])</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (json.dumps(item.json_dict()), {<span class="st">&quot;Content-Type&quot;</span>: <span class="st">&quot;application/json&quot;</span>})</span></code></pre></div>
<h1 id="conclusion">Conclusion</h1>
<p>Without much experience developing python applications, this simple application ended up taking me approximately 5 hours to build from start to finish. I found approximately 80% of that time amounted to looking for errors that would have been detected by the type system of even a rudimentary typed language.</p>
<p>Compared to Go, I found the APIs for defining endpoints a bit simpler due to the lack of support for pluggable middleware systems, but the lack of obvious support of mocking the HTTP server makes code testability a problem. Comapred to haskell with Servant I found the process of API definition tedious, the JSON serialization absurdly contorted, and the lack of type safety more than doubled the amount of time required to complete the application.</p>
<p>While I have a much greater apprecation for the capabilities of Python for developing web applications, I am unlikely to pick it up as a first, or even fourth or fifth option for any restful services I develop in the future.</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
