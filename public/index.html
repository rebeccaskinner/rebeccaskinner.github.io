<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "/"
        },
        "articleSection" : "",
        "name" : "",
        "headline" : "",
        "description" : "",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2018",
        "datePublished": "2018-05-09 00:00:00 &#43;0000 UTC",
        "dateModified" : "2018-05-09 00:00:00 &#43;0000 UTC",
        "url" : "/",
        "wordCount" : "2",
        "keywords" : [ "Blog" ]
    }
    </script>
        
            
                <title>Rebecca Skinner</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.38" />
        


        
        
            
                <meta name="description" content="Thoughts on Software, Technology, and Computer Science">
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Thoughts on Software, Technology, and Computer Science"/>
<meta name="twitter:site" content="@cercerilla"/>

        <meta property="og:title" content="" />
<meta property="og:description" content="Thoughts on Software, Technology, and Computer Science" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/" />



<meta property="og:updated_time" content="2018-05-09T00:00:00&#43;00:00"/>










        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        
<meta itemprop="name" content="">
<meta itemprop="description" content="Thoughts on Software, Technology, and Computer Science">


        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/add-on.css">
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="/">Rebecca Skinner</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="/about/">
                            <i class="fa fa-id-card-o">&nbsp;</i>Resume
                    </a>
                </li>
            
                <li>
                    <a href="/blog/">
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="/categories/">
                            <i class="fa fa-sitemap">&nbsp;</i>Categories
                    </a>
                </li>
            
                <li>
                    <a href="/contact/">
                            <i class="fa fa-envelope-o">&nbsp;</i>Contact
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about/">
                            <h3>
                                <i class="fa fa-id-card-o">&nbsp;</i>Resume
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/blog/">
                            <h3>
                                <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories/">
                            <h3>
                                <i class="fa fa-sitemap">&nbsp;</i>Categories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/contact/">
                            <h3>
                                <i class="fa fa-envelope-o">&nbsp;</i>Contact
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/python_and_nix/">Building Python Applications with Nix</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-05-09'>
                                    May 9, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/python_todo_list/">Building A Todo List with Python and Flask</a></h3>
                                
                                <time class="published" datetime=
                                    '0001-01-01'>
                                    January 1, 0001</time>
                            </header>
                            

                        </article>
                

                
            </div>
        </section>

    
        
</section>

    
    <div id="main">
        
            <article class="post">
  <header>
    <div class="title">
        
            <h2><a href="/blog/python_and_nix/">Building Python Applications with Nix</a></h2>
        
        
            <p>An overview of using nix to manage python development environments</p>
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2018-05-09'>
            May 9, 2018</time>
        <span class="author">Rebecca Skinner</span>
        
            <p>6 minute read</p>
        
        
    </div>
</header>


  

  

  <div id="content">
    

<h2 id="introduction">Introduction</h2>

<p>Nix is a package general purpose package manager available for *nix systems,
including Linux (including <a href="https://nixos.org">NixOS</a>), *bsd, and MacOS.  Nix
provides several novel capabilities, specifically immutability and
reproducability.  A nix package defines exact versions of all of it&rsquo;s
dependencies, and a nix installation manages each individual application
independently.  In this post we&rsquo;ll look at using Nix during the development
process, comparing it to virtualenv and pip for developing a python application.</p>

<h2 id="background">Background</h2>

<p>Most software developers these days find ourselves working across a variety of
applications written in different languages, with different dependencies, and
targeting different platforms.  The net result of this is a proliferation of
tools designed to address the problem of how to manage our development
environments.  Most of these tools are specialized in one way or another.  Tools
like homebrew, apt, and chocolatey may help us install applications, but then we
must turn to separate tools, often language specific, like pip, gem, and hex to
install language dependencies.  Tools like virtualenv, rbenv, and pkg-config
help us manage separate tool and dependency versions.  We may even use tools
like Docker to make it easier to distribute our applications across different
environments.</p>

<p>Some languages and toolchains, like <code>go dep</code> and haskell&rsquo;s <code>stack</code> and
<code>cabal-install</code>, manage versioning and dependencies within the scope of a
project&rsquo;s source tree, others like virtualenv, manage virtual environments with
through environment variables or symlinks.</p>

<p>The nix package manager addresses several many of the problems that developers
might otherwise need to use multiple tools to manage.  Nix provides a mechanism
to create immutable environments for building and running applications by
combining package installation, dependency management, and environment setup all
in a single tool.  Nix can be used in place of tools like homebrew or apt to
distribute and install packages, it can be used to manage local user-wide
environment options like shell and editor configs, and it can be used to manage
the build environment for specific applications.  These configurations can be
composed and combined into unique reproducible environments.</p>

<p>The rest of this article will focus on one particular use-case of nix: as a
replacement for tools that manage virtual environments.  In our example we will
be developing a python application, and using nix in place of virtualenv to
manage our applications dependencies.</p>

<h2 id="setting-up-the-environment">Setting Up the Environment</h2>

<h3 id="install-nix">Install Nix</h3>

<p><a href="https://nixos.org/nix/">Nix</a> can be installed on most *nix systems from source or via a curl-bash
command.</p>

<pre><code>curl https://nixos.org/nix/install | sh
</code></pre>

<p>Once you&rsquo;ve installed nix, you&rsquo;ll want to configure your local environment to
use nix.  Add the following into your <code>${HOME}/.bashrc</code>:</p>

<pre><code>source /home/rebecca/.nix-profile/etc/profile.d/nix.sh
</code></pre>

<p>You can check that everything is working by running:</p>

<pre><code>rebecca@debian:~$ which hello
rebecca@debian:~$ echo $? # demonstrate that &quot;hello&quot; wasn't installed
rebecca@debian:~$ nix-shell -p hello # start nix-shell including hello
[nix-shell:~]$ which hello # now it's found!
/nix/store/6mab2znnw7j96k3vsdw9vyckady29r46-hello-2.10/bin/hello
[nix-shell:~]$ exit
</code></pre>

<h3 id="create-a-development-environment">Create a development Environment</h3>

<p>The sample project we&rsquo;ll be using is a small <a href="https://github.com/rebeccaskinner/py-todo">Python 3 web
appliation</a> built using
<a href="http://flask.pocoo.org/">Flask</a>.  We&rsquo;ll have minimal dependencies, in this case
just python3 and the flask library.</p>

<p>We&rsquo;ll start by creating a nixpkg called <code>default.nix</code>.  The first thing we&rsquo;ll
want to do is import the list of nixpkgs that we know about in our environment:</p>

<pre><code>with import&lt;nixpkgs&gt; {};
</code></pre>

<p>The <code>with</code> keyword allows us to bring a set of variables into scope in a
statement.  The <code>import</code> allows us to import another nix package.  In our case,
<code>&lt;nixpkgs&gt;</code> is an nix variable defined in the <code>$NIX_PATH</code> environment variable:</p>

<pre><code>[nix-shell:~/projects/py-todo]$ echo ${NIX_PATH}
nixpkgs=/home/rebecca/.nix-defexpr/channels/nixpkgs
</code></pre>

<p>The import statement allows us to specify parameters that will be passed into
the nixpkgs that we import.  In our case, we don&rsquo;t want to pass anything in so
we simply use <code>{}</code> in our import statement.</p>

<h4 id="derivations">Derivations</h4>

<p>Derivations are the core of building nixpkgs.  A derivation is, in short, a nix
statement that tells us how to derive the environment for a given package.  In
our case, we want to derive our environment starting with the default standard
environment, which will give us things like a bash shell and standard tools like
<code>make</code> and <code>gcc</code>:</p>

<pre><code>stdenv.mkDerivation rec {
  name = &quot;env&quot;;
}
</code></pre>

<p>The <code>rec</code> keyword allows us to have recrusively defined references.  This means
that individual fields in our derivation can reference on another.  Allowing
these greatly simplifies the process of writing our derivations, at the cost of
having nix expressions that may not terminate.</p>

<h4 id="declaring-dependencies">Declaring Dependencies</h4>

<p>To declare our dependencies, we&rsquo;ll first create a list of nix package names that
we need for our environment.  We can find the names of the packages that we want
to install with <code>nix-env</code>.</p>

<p>Looking up the available python 3 packages is straightforward:</p>

<pre><code>rebecca@debian:~/projects/py-todo$ nix-env -qaP python3
nixpkgs.python34      python3-3.4.8
nixpkgs.python34Full  python3-3.4.8
nixpkgs.python35      python3-3.5.5
nixpkgs.python35Full  python3-3.5.5
nixpkgs.python3       python3-3.6.5
nixpkgs.python36Full  python3-3.6.5
nixpkgs.python3Full   python3-3.6.5
</code></pre>

<p>Looking for the name of our Flask package is a bit more difficult since we&rsquo;re
not entirely sure what it might be called.  We can use grep to broaden our search:</p>

<pre><code>rebecca@debian:~/projects/py-todo$ nix-env -qaP | grep Flask | grep python3.6
nixpkgs.python36Packages.flask                                           python3.6-Flask-0.12.2
nixpkgs.python36Packages.flask_assets                                    python3.6-Flask-Assets-0.12
nixpkgs.python36Packages.flask-autoindex                                 python3.6-Flask-AutoIndex-0.6
nixpkgs.python36Packages.flaskbabel                                      python3.6-Flask-Babel-0.11.1
nixpkgs.python36Packages.flask-babel                                     python3.6-Flask-Babel-0.11.2
nixpkgs.python36Packages.flask_cache                                     python3.6-Flask-Cache-0.13.1
nixpkgs.python36Packages.flask-common                                    python3.6-Flask-Common-0.2.0
nixpkgs.python36Packages.flask-compress                                  python3.6-Flask-Compress-1.4.0
nixpkgs.python36Packages.flask-cors                                      python3.6-Flask-Cors-3.0.3
nixpkgs.python36Packages.flask_elastic                                   python3.6-Flask-Elastic-0.2
nixpkgs.python36Packages.flask-limiter                                   python3.6-Flask-Limiter-1.0.1
nixpkgs.python36Packages.flask_login                                     python3.6-Flask-Login-0.4.1
nixpkgs.python36Packages.flask_mail                                      python3.6-Flask-Mail-0.9.1
nixpkgs.python36Packages.flask_migrate                                   python3.6-Flask-Migrate-2.1.1
nixpkgs.python36Packages.flask_oauthlib                                  python3.6-Flask-OAuthlib-0.9.3
nixpkgs.python36Packages.flask_principal                                 python3.6-Flask-Principal-0.4.0
nixpkgs.python36Packages.flask-pymongo                                   python3.6-Flask-PyMongo-0.5.1
nixpkgs.python36Packages.flask-restful                                   python3.6-Flask-RESTful-0.3.6
nixpkgs.python36Packages.flask_script                                    python3.6-Flask-Script-2.0.6
nixpkgs.python36Packages.flask-silk                                      python3.6-Flask-Silk-0.2
nixpkgs.python36Packages.flask_sqlalchemy                                python3.6-Flask-SQLAlchemy-2.1
nixpkgs.python36Packages.flask_testing                                   python3.6-Flask-Testing-0.7.1
nixpkgs.python36Packages.flask_wtf                                       python3.6-Flask-WTF-0.14.2
</code></pre>

<p>Now that we know what packages we need to import, we can declare them in our
list of dependencies, which We&rsquo;ll call <code>dependencies</code>:</p>

<pre><code>dependencies = [
  python3
  python36Packages.flask
]
</code></pre>

<p>Notice the pattern of our package names.  <code>python3</code> refers to the <code>python3</code>
package, which we can see is pinned to <code>python3-3.6.5</code>.  Likewise, our Flask
package, <code>python36Packages.flask</code> is pinned to <code>python3.6-Flask-0.12.2</code>.  For
python packages, the general pattern for package names will be
<code>pythonXYPackages.PackageName</code></p>

<h4 id="configuring-our-environment">Configuring our environment</h4>

<p>The <code>stdenv</code> derivation will import several additional nix packages for us.
Among them is the <code>buildenv</code> package, which allows us to setup a build
environment.  This build environment is what we&rsquo;ll use for interactive
development in our application.</p>

<p>The <code>buildEnv</code> package has several variables that we can set to fine-tune our
build environment.  For our purposes we are concerned with setting the name of
our environment and the paths that we want to import into our working
environment.</p>

<p>We set variables inside of a nix package using braces.  In the snippet below we
are bringing in the <code>buildEnv</code> package with our custom name and import paths:</p>

<pre><code>env = buildEnv {
  name = name;
  paths = dependencies;
};
</code></pre>

<h4 id="our-finished-nixpkg">Our Finished nixpkg</h4>

<p>Putting all of the above together, we find ourselves with a rather small nixpkg
that brings in everything we need for our application:</p>

<pre><code>with import&lt;nixpkgs&gt; {};
stdenv.mkDerivation rec {
  name = &quot;env&quot;;
  dependencies = [
    python3
    python36Packages.Flask
  ];
  env = buildEnv {
    name = name;
    paths = dependencies;
  };
}
</code></pre>

<h2 id="running-our-application">Running Our Application</h2>

<p>Once we&rsquo;ve set up our <code>default.nix</code> file, running our application inside of our
nix environment is as simple as calling <code>nix-shell</code>.  This will set up a local
environment with our requested packages available in our <code>$PATH</code> so that all of
our dependencies are available.</p>

<pre><code>rebecca@debian:~/projects/py-todo$ nix-shell
[nix-shell:~/projects/py-todo]$ which python3
/nix/store/96wn2gz3mwi71gwcrvpfg39bsymd7gqx-python3-3.6.5/bin/python3
[nix-shell:~/projects/py-todo]$ which flask
/nix/store/swamiw3ygj9wws3spa44wgmjxhlldj3y-python3.6-Flask-0.12.2/bin/flask
[nix-shell:~/projects/py-todo]$ ./run_server
 * Serving Flask app &quot;todo_server&quot;
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
</code></pre>

<h2 id="credits-and-further-reading">Credits and Further Reading</h2>

<ul>
<li><a href="https://ocharles.org.uk/blog/posts/2014-02-04-how-i-develop-with-nixos.html">How I Develop with NixOS</a></li>
<li><a href="https://ariya.io/2016/06/isolated-development-environment-using-nix">Isolated Development Environment using Nix</a></li>
<li><a href="https://nixos.org/nix/manual/">The Nix Manual</a></li>
</ul>

  </div>

  <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
            
            
                <i class="fa fa-folder"></i>
                
                
                <li><a class="article-category-link" href="/categories/python">python</a></li>
                
                
                <li><a class="article-category-link" href="/categories/nix">nix</a></li>
                
            
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
            
            
                <i class="fa fa-tags"></i>
                
                
                <li><a class="article-category-link" href="/tags/python">python</a></li>
                
                
                <li><a class="article-category-link" href="/tags/nix">nix</a></li>
                
                
                <li><a class="article-category-link" href="/tags/practice">practice</a></li>
                
            
        
    </ul>
  </li>
</ul>

  </footer>

</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "shortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="/blog/python_todo_list/"
                class="button big previous">Building A Todo List with Python and Flask</a></li>
    

    
</ul>



            <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            
























<li>
  <a href="mailto:?subject=Check out this post by Rebecca%20Skinner&amp;body=%2fblog%2fpython_and_nix%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>


        </ul>
    </section>
</section>

        
    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/'><img src="/img/main/logo.png" width="" alt="Hugo Future Imperfect" /></a>
      
    
    
      <header>
        <h2>Rebecca Skinner</h2>
        <p>Thougs on functional languages, technology, teaching, and industry.</p>
      </header>
    
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/python_and_nix/">Building Python Applications with Nix</a>
              </h3>
              
              <time class="published" datetime='2018-05-09'>
                May 9, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/python_todo_list/">Building A Todo List with Python and Flask</a>
              </h3>
              
              <time class="published" datetime='0001-01-01'>
                January 1, 0001
              </time>
            </header>
            

          </article>
        
      </div>

      
    </div>
  </section>

  
  
  
  
  
    <section id="categories">
      <header>
        <h3>
          <a href="/categories/">Categories</a>
        </h3>
      </header>
        
          
        

        
        <p>
          <article>
            <header>
              
                <a href="/categories/python/">python</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/flask/">flask</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/nix/">nix</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
    </section>
  
  

  
  
    <section id="mini-bio">
      <h3>About</h3>
      <p>Rebecca Skinner is a software developer, speaker, and author based in St. Louis, Missouri.  Her interests include functional programming languages, distributed systems, signal processing, computer vision, and data science.</p>
      <a href="/about/" class="button">Learn More</a>
    </section>
  

  
  <section id="footer">
    
    <p class="copyright">
      
        &copy; 2018
        
          Rebecca Skinner
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/css.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
      <script src="/js/backToTop.js"></script>
    

    
      
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

